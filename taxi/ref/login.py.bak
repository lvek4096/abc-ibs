import tkinter as tk
import random as rd
import mysql.connector as ms
import platform as pf

build='Alpha'

uuid='U'+str(rd.randint(1000,9999))

#MySQL
con=ms.connect(host='localhost',user='john',password='123456',database='taxi')
cur=con.cursor()

#GUI
logwin=tk.Tk()
logwin.title('GNU')
fnt=('IBM Plex Mono',12)
fntit=('IBM Plex Mono',12,'italic')
h1fnt=('IBM Plex Sans',24)


def login():
	uname_inp=uname.get()
	passwd_inp=passwd.get()
	cur.execute('select uname,passwd from users')
	op=dict(cur.fetchall())
	msg=tk.Label(logwin,font=fntit);msg.grid(column=0,row=6)
	if uname_inp not in op.keys():
		msg.configure(text='Username '+uname_inp+' does not exist.')
	else:
		if not passwd_inp == op[uname_inp]:
			msg.configure(text='Invalid password for '+uname_inp)
		else:
			msg.configure(text='Welcome '+uname_inp)



def regpop():
	def register():
		reg_uname_inp=reg_uname.get().lower()
		reg_passwd_inp=reg_passwd.get()

		cur.execute('select uname from users')
		op=list(cur.fetchall())
		if not reg_passwd_inp == None:

			l2=[uuid,reg_uname_inp,reg_passwd_inp]

			regsql='insert into users values(%s,%s,%s)'
			regval=(uuid,reg_uname_inp,reg_passwd_inp)

			cur.execute(regsql,regval)
			con.commit()


		
			tk.Label(regwin,text='Registration success.',font=fnt).grid(column=1,row=6)
			tk.Label(regwin,text=str(l2),font=fnt).grid(column=1,row=7)
		else:
			tk.Label(regwin,text='Password not entered',font=fnt).grid(column=1,row=6)

	regwin=tk.Tk()
	regwin.title('Register')
	tk.Label(regwin,text='Register',font=h1fnt).grid(column=1,row=0)
	tk.Label(regwin,text='ID',font=fnt).grid(column=0,row=3)
	tk.Label(regwin,text=uuid,font=fnt).grid(column=1,row=3)
	tk.Label(regwin,text='Username',font=fnt).grid(column=0,row=4)
	reg_uname=tk.Entry(regwin,font=fnt);reg_uname.grid(column=1,row=4)

	tk.Label(regwin,text='Password',font=fnt).grid(column=0,row=5)
	reg_passwd=tk.Entry(regwin,show='*',font=fnt);reg_passwd.grid(column=1,row=5)
	regbtn=tk.Button(regwin,text='Register',font=fnt,command=register);regbtn.grid(column=1,row=6)
	regbtn=tk.Button(regwin,text='Close',font=fnt,command=regwin.destroy);regbtn.grid(column=2,row=6)
	tk.Label(regwin,text=('Build '+build+' on\n'+pf.system()+' '+pf.release()),font=fntit).grid(column=0,row=12)
	
	


#Window
tk.Label(logwin,text='Welcome',font=h1fnt).grid(column=1,row=0)

tk.Label(logwin,text='Username',font=fnt).grid(column=0,row=3)
uname=tk.Entry(logwin,font=fnt);uname.grid(column=1,row=3)

tk.Label(logwin,text='Password',font=fnt).grid(column=0,row=4)
passwd=tk.Entry(logwin,show='*',font=fnt);passwd.grid(column=1,row=4)

submit=tk.Button(logwin,text='Check',font=fnt,command=login);submit.grid(column=1,row=5)
#tk.Label(logwin,text='Click to register ->',font=fnt).grid(column=1,row=8)
submit=tk.Button(logwin,text='Register',font=fnt,command=regpop);submit.grid(column=2,row=8)
tk.Label(logwin,text=('Build '+build+' on\n'+pf.system()+' '+pf.release()),font=fntit).grid(column=0,row=12)
logwin.mainloop()